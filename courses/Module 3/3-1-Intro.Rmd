---
title: "Introduction to Machine Learning  <br> <br> <br>"
author: "Omni Analytics Group"
output:
  xaringan::moon_reader:
    includes:
      after_body: insert-logo.html
    css: [default, default-fonts, classroom.css]
    lib_dir: libs
    nature:
      ratio: 16:9
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, fig.align = "center")

```

## Module 3 Outline

- Part 1: 
    - Intro to DDEMA: understand each of the steps of the data science process and learn the ML workflow. 
    - D for definition: We want to find characteristics of people who own cryptocurrency
    - Data and Exploration: 
          - Explore and find issues in the adult dataset - missing values, outliers values
          - Answering data questions, t tests, Viz
- Part 2: 
    - M for Modeling - Unsupervised Machine Learning techniques: Given an unlabelled dataset, we will learn how to find patterns with minimal effort 
    - Using k-means
    - Naming clusters
    - Evaluate these patterns that were found, and visualize them effectively
    - Other clustering techniques: hclust, pam
- Part 3:
    - M for Modeling - Supervised Learning techniques: Using a labelled dataset to create a model, and predict future trends or categorize unseen data
    - Using glm, svm, CART, xgboost, randomforests
    - Evaluation of the models - class metrics and differences
    - Feature importance
    - Feature engineering or data prep
    - A for Action - how might this be useful for us - targeting campaigns, cross selling products
    - Further Optimizations: Hyperparameter tuning and Cross validation

---

## DDEMA

-	Defining the problem well to create mathematical objective
-	Data Ingestion - collecting
-	Exploration and Validation - summary stats, error detection
  -	Data Wrangling (Cleaning) 
  -	Data Labeling 
-	Model Engineering pipeline
  -	Data splitting into train and test
  -	Feature engineering
  -	Hyperparam tuning
-	Action 

---

## Outline Data and exploration - DDE

- read in data
- summary stats or using skimr package
- Your turn: what are possible missing values? 
    - In the adults dataset there are '?' instead of NA and 9999 encoded to denote missing values 
    - Code to convert these to NA
- Asking questions of the data: How many men as a proportion of the total men own ethereum? Same for women
- T tests
- Visualizations

---

## Data

<data description: Our dataset is an adaptation of the census survey dataset, where we also have answers to the question "Do you own ethereum?" -- make possible joke about $5 attack>

- load library for analysis
- read in data

```{r echo=TRUE}
library(tidyverse)
load("data_new.RDS")

```

Let's look at the dimensions of the data
```{r}
dim(data_new)
```

---

and the first few rows
```{r}
head(data_new)
```
notice that the owns_ethereum column is shown as character, this can be converted to a factor data type to be represented correctly

---

## Assigning data types

Convert owns_ethereum and other character variables to factor data type
now try summary again

```{r}
data <- data_new %>%
    mutate(across(where(is.character), as_factor))
```
---
```{r, echo=FALSE, fig.show='hold'}
summary(data)
```

also note max of '99999' in capital_gain colum and '99' in hours_per_week. Let's look at these two columns again.

---
## Histogram to see capital gain and hours_per_week

```{r}
ggplot(data, aes(x = capital_gain)) +
  geom_histogram()
ggplot(data, aes(x = hours_per_week)) +
  geom_histogram()
```
---

## Missing Values

- 9999 in capital_gain and 99 in hours_per_week were encoded to denote missing values 
- Code to convert these to NA

```{r}
data <- data %>%
    mutate(capital_gain = ifelse(capital_gain == 99999, NA, capital_gain)) %>%
    mutate(hours_per_week = ifelse(hours_per_week == 99, NA, hours_per_week)) 
```
---

# Summary using skimr

skimr is a useful package to view distributions and missing values in columns
```{r, eval=FALSE, fig.keep='none'}
library(skimr)
data %>%
    skim()
```
---

```{r, echo = FALSE, out.height=5, fig.height=5}
data %>%
    skimr::skim()
```

---

## Ask questions

What is the proportion of owners vs non owners?

```{r}
data %>%
    group_by(owns_ethereum) %>%
    summarise(n = n(), nperc = n/nrow(data)*100)
```

---

What is the percentage of Male vs Female owners?

```{r}
data %>%
 filter(owns_ethereum == "TRUE") %>%
 group_by(sex) %>%
 summarise(n = n(), nperc = n/nrow(.)*100)
```

---

What percentage of ethereum owners are also donors?

```{r}
data %>%
    filter(owns_ethereum == "TRUE") %>%
    group_by(donated) %>%
    summarise(n = n(), nperc = n/nrow(.)*100)

```

---

Most common characteristics or features.

Find the mode or the most frequently occurring features -- need to know applying functions

```{r, fig.height=8}

get_mode <- function(v) {
    uniqv <- unique(v)
    uniqv[which.max(tabulate(match(v, uniqv)))]
}


data %>%
    group_by(owns_ethereum) %>%
    summarise_all(funs(get_mode(.))) %>%
    data.frame()

```

We see that donors, and higher education, lower age, are more in number in the owns_ethereum = TRUE group

---

## T-test

We can test these findings for statistical significance. t test to see difference between ages of ethereum owners and non owners

```{r}
t.test(age ~ owns_ethereum, data = data)
```
---

```{r}
t.test(education_num ~ owns_ethereum, data = data)
```

We see that there is a significant difference (p<0.05) between the age, and education of ethereum owners vs non owners

---

## Visualizations

```{r}
ggplot(data, aes(x = owns_ethereum, y = education_num)) +
  geom_boxplot()

ggplot(data, aes(x = owns_ethereum, y = age)) +
  geom_boxplot()

ggplot(data, aes(x = owns_ethereum, y = hours_per_week)) +
  geom_boxplot()
```

---

One trick to look at multiple variables at the same time, is to use pair plots and color the points by the owns_ethereum variable.

Use the GGally package to create pair plots of all the variables
```{r, eval=FALSE, fig.show='hold'}
library(GGally)
# numerical vars
data %>%
    select(owns_ethereum, age, education_num, capital_gain, capital_loss, hours_per_week) %>%
    ggpairs(columns = 2:6, aes(color = owns_ethereum, alpha = 0.5))
```

---
```{r, echo=FALSE, fig.show='asis'}
library(GGally)
data %>%
    select(owns_ethereum, age, education_num, capital_gain, capital_loss, hours_per_week) %>%
    ggpairs(columns = 2:6, aes(color = owns_ethereum, alpha = 0.5))
```
---

For categorical variables it helps to see the proportions to understand which variables contribute more to the groups

```{r cat, eval=FALSE, fig.show='hold'}
# categorical vars - note NAs
data %>%
    select(
        workclass, marital_status, occupation,
        relationship, race, sex, native_country, donated, owns_ethereum
    ) %>%
    pivot_longer(workclass:donated) %>%
    ggplot(aes(y = value, fill = owns_ethereum)) +
    geom_bar(position = "fill", na.rm = FALSE) +
    facet_wrap(vars(name), scales = "free") +
    labs(x = NULL, y = NULL, fill = NULL)

```

---

```{r eval= TRUE, echo=FALSE}
# categorical vars - note NAs
data %>%
    select(
        workclass, marital_status, occupation,
        relationship, race, sex, native_country, donated, owns_ethereum
    ) %>%
    pivot_longer(workclass:donated) %>%
    ggplot(aes(y = value, fill = owns_ethereum)) +
    geom_bar(position = "fill", na.rm = FALSE) +
    facet_wrap(vars(name), scales = "free") +
    labs(x = NULL, y = NULL, fill = NULL)

```

---

## Your Turn 
 
Answer the question using visuals and a statistical test

- Do older adults donate more?

---

Answer

```{r}
ggplot(data, aes(x = donated, y = age)) +
  geom_boxplot()
```

---

```{r}
t.test(age ~ donated, data)
```

---
